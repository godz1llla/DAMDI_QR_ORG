<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√°mdi QR - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <style>
        :root {
            --orange-primary: #F37321;
            --bg-page: #F7F8FC;
            --bg-header: #FFFFFF;
            --bg-card: #FFFFFF;
            --bg-nav: #F0F1F5;
            --bg-nav-active: #333333;
            --text-dark: #222222;
            --text-secondary: #888888;
            --text-light: #FFFFFF;
            --text-accent: #34A853;
            --border-color: #ECEEF3;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --border-radius-card: 12px;
            --border-radius-small: 8px;
            --shadow-card: 0 4px 15px rgba(220, 220, 230, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-page);
            color: var(--text-dark);
        }

        .main-header {
            background-color: var(--bg-header);
            padding: 15px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        .restaurant-info { display: flex; align-items: center; gap: 15px; }
        .restaurant-info .logo {
            width: 40px; height: 40px;
            background-color: var(--orange-primary);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px;
        }
        .restaurant-info .name { font-weight: 600; font-size: 16px; }
        .restaurant-info .owner { font-size: 14px; color: var(--text-secondary); }

        .logout-button {
            display: flex; align-items: center; gap: 8px;
            padding: 8px 16px; border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small);
            font-size: 14px; font-weight: 500;
            background: none; cursor: pointer;
            transition: background-color 0.2s;
        }
        .logout-button:hover { background-color: #f5f5f5; }

        .dashboard-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 50px;
        }

        .dashboard-nav {
            display: inline-flex;
            gap: 8px;
            background-color: var(--bg-nav);
            border-radius: var(--border-radius-small);
            padding: 5px;
            margin-bottom: 30px;
        }
        .nav-item {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 20px;
            border: none;
            background-color: transparent;
            border-radius: 6px;
            font-size: 14px; font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer; transition: all 0.2s;
        }
        .nav-item.active { background-color: var(--bg-nav-active); color: var(--text-light); }
        .nav-item:not(.active):hover { background-color: #E0E1E5; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background-color: var(--bg-card);
            padding: 25px;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-card);
        }
        .stat-card .title { color: var(--text-secondary); margin-bottom: 15px; font-size: 16px; }
        .stat-card .value { font-size: 32px; font-weight: 700; margin-bottom: 8px; }
        .stat-card .value.revenue { color: var(--text-accent); }
        .stat-card .description { font-size: 14px; color: var(--text-secondary); }

        .content-card {
            background-color: var(--bg-card);
            padding: 30px;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-card);
            margin-bottom: 30px;
        }
        .card-header { margin-bottom: 20px; }
        .card-header .title { font-size: 20px; font-weight: 700; margin-bottom: 5px; }
        .card-header .subtitle { font-size: 14px; color: var(--text-secondary); }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .order-item:last-child { border-bottom: none; }
        .order-details .timestamp { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .order-details .dishes { font-size: 16px; font-weight: 600; }
        
        .order-summary .price { font-size: 16px; font-weight: 700; text-align: right; margin-bottom: 8px; }
        .order-summary .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-badge.NEW { background-color: #FEF7E6; color: #F3B716; }
        .status-badge.PREPARING { background-color: #EAF2FE; color: #3682F4; }
        .status-badge.SERVED { background-color: #E6F6E9; color: #34A853; }

        .btn-primary {
            padding: 12px 25px;
            background-color: var(--orange-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-small);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-primary:hover { opacity: 0.9; }

        .page { display: none; }
        .page.active { display: block; }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius-card);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        .close-modal:hover {
            color: var(--text-dark);
        }

        .category-section {
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-card);
            overflow: hidden;
        }
        .category-header {
            padding: 20px;
            background: var(--bg-page);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            font-size: 18px;
        }
        .dishes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        .dish-item {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small);
            padding: 15px;
            position: relative;
        }
        .dish-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: var(--border-radius-small);
            margin-bottom: 10px;
        }
        .dish-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .dish-price {
            color: var(--text-accent);
            font-weight: 700;
            font-size: 18px;
        }
        .dish-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .dish-actions button {
            flex: 1;
            padding: 5px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .dish-actions button:hover {
            background: var(--bg-page);
        }

        .premium-benefits {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .premium-benefits h3 {
            color: var(--orange-primary);
            margin-bottom: 15px;
        }

        .premium-benefits ul {
            list-style: none;
            padding: 0;
        }

        .premium-benefits li {
            padding: 8px 0;
            font-size: 16px;
        }

        .table-card {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-card);
            padding: 20px;
            text-align: center;
            transition: box-shadow 0.2s;
        }
        .table-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .table-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--orange-primary);
        }
        .qr-placeholder {
            width: 150px;
            height: 150px;
            margin: 15px auto;
            background: linear-gradient(135deg, var(--bg-page) 0%, #e8e8e8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-small);
            border: 2px dashed var(--border-color);
        }

        .staff-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .staff-item:last-child {
            border-bottom: none;
        }
        .staff-info .name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .staff-info .email {
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="restaurant-info">
            <div class="logo">üçΩÔ∏è</div>
            <div>
                <div class="name" id="restaurantName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="owner" id="ownerName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        <button class="logout-button" id="logoutBtn">‚Üí –í—ã–π—Ç–∏</button>
    </header>

    <main class="dashboard-container">
        <nav class="dashboard-nav">
            <button class="nav-item active" data-page="home">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-item" data-page="menu">üìã –ú–µ–Ω—é</button>
            <button class="nav-item" data-page="tables">ü™ë –°—Ç–æ–ª–∏–∫–∏</button>
            <button class="nav-item" data-page="staff">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
            <button class="nav-item" data-page="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </nav>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞: –ì–ª–∞–≤–Ω–∞—è -->
        <div id="home" class="page active">
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="title">–ó–∞–∫–∞–∑–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
                    <div class="value" id="todayOrders">0</div>
                    <div class="description">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</div>
                </div>
                <div class="stat-card">
                    <div class="title">–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                    <div class="value revenue" id="todayRevenue">0 ‚Ç∏</div>
                    <div class="description">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</div>
                </div>
                <div class="stat-card">
                    <div class="title">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                    <div class="value" id="avgCheck">0 ‚Ç∏</div>
                    <div class="description">–í —Å—Ä–µ–¥–Ω–µ–º</div>
                </div>
                <div class="stat-card">
                    <div class="title">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–æ–ª–∏–∫–æ–≤</div>
                    <div class="value" id="activeTables">0</div>
                    <div class="description">–°–µ–π—á–∞—Å –∑–∞–Ω—è—Ç–æ</div>
                </div>
            </section>

            <section class="content-card">
                <div class="card-header">
                    <h2 class="title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h2>
                    <p class="subtitle">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</p>
                </div>
                <div id="recentOrders"></div>
            </section>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞: –ú–µ–Ω—é -->
        <div id="menu" class="page">
            <section class="content-card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 class="title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é</h2>
                    <p class="subtitle">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –±–ª—é–¥–∞ –≤–∞—à–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</p>
                    <div id="categoriesLimitInfo" style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" id="addCategoryBtn">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    <button class="btn-primary" id="addDishBtn">+ –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</button>
                </div>
                </div>
                <div id="menuContent"></div>
            </section>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞: –°—Ç–æ–ª–∏–∫–∏ -->
        <div id="tables" class="page">
            <section class="content-card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 class="title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–∞–º–∏</h2>
                    <p class="subtitle">QR-–∫–æ–¥—ã –∏ —Å—Ç–∞—Ç—É—Å—ã —Å—Ç–æ–ª–∏–∫–æ–≤</p>
                    <div id="tablesLimitInfo" style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                <button class="btn-primary" id="addTableBtn">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–∏–∫</button>
                </div>
                <div id="tablesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;"></div>
            </section>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ -->
        <div id="staff" class="page">
            <section class="content-card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 class="title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h2>
                        <p class="subtitle">–ö–æ–º–∞–Ω–¥–∞ –≤–∞—à–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</p>
                    </div>
                    <button class="btn-primary" id="addStaffBtn">+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                </div>
                <div id="staffList"></div>
            </section>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="settings" class="page">
            <section class="content-card">
                <div class="card-header">
                    <h2 class="title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</h2>
                    <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</p>
                </div>
                <form id="settingsForm" style="max-width: 600px;">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ *</label>
                        <input type="text" name="name" id="settingsName" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ê–¥—Ä–µ—Å</label>
                        <input type="text" name="address" id="settingsAddress" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="phone" id="settingsPhone" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω</label>
                        <input type="text" id="settingsPlan" readonly style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-page);">
                    </div>
                    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </form>
            </section>

            <section class="content-card">
                <div class="card-header">
                    <h2 class="title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    <p class="subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ</p>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button onclick="loadStats('today')" class="btn-primary">–°–µ–≥–æ–¥–Ω—è</button>
                    <button onclick="loadStats('week')" style="padding: 10px 20px; border: 1px solid var(--border-color); background: white; border-radius: 8px; cursor: pointer;">–ù–µ–¥–µ–ª—è</button>
                    <button onclick="loadStats('month')" style="padding: 10px 20px; border: 1px solid var(--border-color); background: white; border-radius: 8px; cursor: pointer;">–ú–µ—Å—è—Ü</button>
                </div>
                <div id="statsContent"></div>
            </section>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é -->
    <div id="categoryModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-modal" onclick="closeModal('categoryModal')">&times;</span>
            <h2 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
            <form id="categoryForm">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                    <input type="text" name="name" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeModal('categoryModal')" style="padding: 10px 20px; background: white; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ -->
    <div id="dishModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal" onclick="closeModal('dishModal')">&times;</span>
            <h2 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</h2>
            <form id="dishForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="grid-column: 1 / -1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞ *</label>
                        <input type="text" name="name" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name="description" rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;"></textarea>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <select name="category_id" required id="dishCategorySelect" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–¶–µ–Ω–∞ (‚Ç∏) *</label>
                        <input type="number" name="price" required min="0" step="0.01" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                        <input type="file" name="image" accept="image/*" id="dishImageInput" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                        <div id="imagePreview" style="margin-top: 10px;"></div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeModal('dishModal')" style="padding: 10px 20px; background: white; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–∏–∫ -->
    <div id="tableModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close-modal" onclick="closeModal('tableModal')">&times;</span>
            <h2 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–∏–∫</h2>
            <form id="tableForm">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ù–æ–º–µ—Ä —Å—Ç–æ–ª–∏–∫–∞ *</label>
                    <input type="text" name="table_number" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeModal('tableModal')" style="padding: 10px 20px; background: white; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div id="staffModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-modal" onclick="closeModal('staffModal')">&times;</span>
            <h2 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
            <form id="staffForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ò–º—è *</label>
                        <input type="text" name="first_name" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–§–∞–º–∏–ª–∏—è *</label>
                        <input type="text" name="last_name" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email *</label>
                        <input type="email" name="email" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ü–∞—Ä–æ–ª—å *</label>
                        <input type="password" name="password" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeModal('staffModal')" style="padding: 10px 20px; background: white; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø–∞ -->
    <div id="premiumModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2 id="premiumModalTitle">–õ–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç</h2>
                <span class="close" onclick="closeModal('premiumModal')">√ó</span>
            </div>
            <div class="modal-body">
                <div id="premiumModalContent">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JavaScript -->
                </div>
                <div class="modal-footer">
                    <button onclick="closeModal('premiumModal')" class="btn-secondary">–ü–æ–Ω—è—Ç–Ω–æ</button>
                    <button onclick="upgradeToPremium()" class="btn-primary">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–º–∏—É–º</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/me.php');
                const data = await response.json();
                
                if (!data.success || data.user.role !== 'ADMIN') {
                    window.location.href = '/login.html';
                    return;
                }
                
                document.getElementById('ownerName').textContent = `${data.user.first_name} ${data.user.last_name}`;
                loadRestaurantInfo();
                loadDashboardStats();
                loadRecentOrders();
            } catch (error) {
                window.location.href = '/login.html';
            }
        }

        async function loadRestaurantInfo() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
            document.getElementById('restaurantName').textContent = '–î–µ–º–æ –†–µ—Å—Ç–æ—Ä–∞–Ω';
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/orders/list.php?limit=100');
                const data = await response.json();
                
                if (data.success) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const todayOrders = data.orders.filter(order => {
                        const orderDate = new Date(order.created_at);
                        return orderDate >= today;
                    });
                    
                    const todayRevenue = todayOrders.reduce((sum, order) => sum + parseFloat(order.total_amount), 0);
                    const avgCheck = todayOrders.length > 0 ? todayRevenue / todayOrders.length : 0;
                    
                    const activeOrders = data.orders.filter(order => 
                        order.status === 'NEW' || order.status === 'PREPARING'
                    );
                    
                    document.getElementById('todayOrders').textContent = todayOrders.length;
                    document.getElementById('todayRevenue').textContent = todayRevenue.toLocaleString('ru-RU') + ' ‚Ç∏';
                    document.getElementById('avgCheck').textContent = avgCheck.toLocaleString('ru-RU') + ' ‚Ç∏';
                    document.getElementById('activeTables').textContent = activeOrders.length;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadRecentOrders() {
            try {
                const response = await fetch('/api/orders/list.php?limit=10');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('recentOrders');
                    container.innerHTML = '';
                    
                    if (data.orders.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-secondary);">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                        return;
                    }
                    
                    data.orders.forEach(order => {
                        const orderItem = document.createElement('div');
                        orderItem.className = 'order-item';
                        
                        const date = new Date(order.created_at);
                        const timeStr = date.toLocaleString('ru-RU', { 
                            hour: '2-digit', 
                            minute: '2-digit',
                            day: '2-digit',
                            month: '2-digit'
                        });
                        
                        let dishesText = '';
                        if (order.items && order.items.length > 0) {
                            dishesText = order.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                        }
                        
                        const statusText = {
                            'NEW': '–ù–æ–≤—ã–π',
                            'PREPARING': '–ì–æ—Ç–æ–≤–∏—Ç—Å—è',
                            'SERVED': '–ü–æ–¥–∞–Ω',
                            'COMPLETED': '–ó–∞–≤–µ—Ä—à—ë–Ω',
                            'CANCELLED': '–û—Ç–º–µ–Ω—ë–Ω'
                        }[order.status] || order.status;
                        
                        orderItem.innerHTML = `
                            <div class="order-details">
                                <div class="timestamp">${timeStr} ‚Ä¢ –°—Ç–æ–ª–∏–∫ ‚Ññ${order.table_number}</div>
                                <div class="dishes">${dishesText}</div>
                            </div>
                            <div class="order-summary">
                                <div class="price">${parseFloat(order.total_amount).toLocaleString('ru-RU')} ‚Ç∏</div>
                                <span class="status-badge ${order.status}">${statusText}</span>
                            </div>
                        `;
                        
                        container.appendChild(orderItem);
                    });
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                const pageId = item.dataset.page;
                document.getElementById(pageId).classList.add('active');
            });
        });

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await fetch('/api/auth/logout.php');
                window.location.href = '/login.html';
            } catch (error) {
                window.location.href = '/login.html';
            }
        });

        // === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ ===
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showPremiumModal(limitType, currentCount, limit, plan) {
            const modal = document.getElementById('premiumModal');
            const modalTitle = document.getElementById('premiumModalTitle');
            const modalContent = document.getElementById('premiumModalContent');
            
            if (limitType === 'tables') {
                modalTitle.textContent = '–õ–∏–º–∏—Ç —Å—Ç–æ–ª–∏–∫–æ–≤ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç';
                modalContent.innerHTML = `
                    <p>–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ ${limit} —Å—Ç–æ–ª–∏–∫–æ–≤ –ø–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º—É —Ç–∞—Ä–∏—Ñ—É.</p>
                    <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ–ª–µ–µ ${limit} —Å—Ç–æ–ª–∏–∫–æ–≤ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –ø—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø.</p>
                    <div class="premium-benefits">
                        <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–º–∏—É–º-—Ç–∞—Ä–∏—Ñ–∞:</h3>
                        <ul>
                            <li>‚úÖ –î–æ 50 —Å—Ç–æ–ª–∏–∫–æ–≤</li>
                            <li>‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
                            <li>‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</li>
                            <li>‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤</li>
                        </ul>
                    </div>
                `;
            } else if (limitType === 'categories') {
                modalTitle.textContent = '–õ–∏–º–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç';
                modalContent.innerHTML = `
                    <p>–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ ${limit} –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º—É —Ç–∞—Ä–∏—Ñ—É.</p>
                    <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ–ª–µ–µ ${limit} –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –ø—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø.</p>
                    <div class="premium-benefits">
                        <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–º–∏—É–º-—Ç–∞—Ä–∏—Ñ–∞:</h3>
                        <ul>
                            <li>‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
                            <li>‚úÖ –î–æ 50 —Å—Ç–æ–ª–∏–∫–æ–≤</li>
                            <li>‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</li>
                            <li>‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤</li>
                        </ul>
                    </div>
                `;
            }
            
            modal.style.display = 'flex';
        }

        function upgradeToPremium() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º-—Ç–∞—Ä–∏—Ñ–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏.\n\n–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã –º–æ–∂–µ—Ç–µ:\n1. –í–æ–π—Ç–∏ –∫–∞–∫ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\n2. –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –Ω–∞ PREMIUM');
            closeModal('premiumModal');
        }

        // === –ú–ï–ù–Æ ===
        let menuData = { categories: [], items: [] };

        async function loadMenu() {
            try {
                const response = await fetch('/api/menu/list.php?restaurant_id=1');
                const data = await response.json();
                
                if (data.success) {
                    menuData.categories = [];
                    menuData.items = [];
                    
                    data.menu.forEach(section => {
                        menuData.categories.push(section.category);
                        menuData.items.push(...section.items);
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–∞—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                    if (data.limits) {
                        const { current_categories, max_categories, plan } = data.limits;
                        const limitInfo = document.getElementById('categoriesLimitInfo');
                        if (plan === 'FREE') {
                            limitInfo.innerHTML = `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${current_categories}/${max_categories} –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ)`;
                        } else {
                            limitInfo.innerHTML = `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${current_categories}/${max_categories} –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø—Ä–µ–º–∏—É–º —Ç–∞—Ä–∏—Ñ)`;
                        }
                    }
                    
                    renderMenu();
                    updateCategorySelect();
                }
            } catch (error) {
                console.error('Error loading menu:', error);
            }
        }

        function renderMenu() {
            const container = document.getElementById('menuContent');
            container.innerHTML = '';
            
            if (menuData.categories.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é.</p>';
                return;
            }
            
            menuData.categories.forEach(category => {
                const categoryItems = menuData.items.filter(item => item.category_id == category.id);
                
                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `
                    <div class="category-header">
                        <span>${category.name} (${categoryItems.length})</span>
                        <button onclick="deleteCategory(${category.id})" style="padding: 5px 15px; background: #E53935; color: white; border: none; border-radius: 4px; cursor: pointer;">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <div class="dishes-grid" id="category-${category.id}"></div>
                `;
                container.appendChild(section);
                
                const grid = document.getElementById(`category-${category.id}`);
                if (categoryItems.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 20px;">–ù–µ—Ç –±–ª—é–¥ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>';
                } else {
                    categoryItems.forEach(item => {
                        const dish = document.createElement('div');
                        dish.className = 'dish-item';
                        dish.innerHTML = `
                            ${item.image_url ? `<img src="${item.image_url}" alt="${item.name}">` : '<div style="width: 100%; height: 150px; background: var(--bg-page); border-radius: 8px; margin-bottom: 10px;"></div>'}
                            <div class="dish-name">${item.name}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">${item.description || ''}</div>
                            <div class="dish-price">${parseFloat(item.price).toLocaleString('ru-RU')} ‚Ç∏</div>
                            <div class="dish-actions">
                                <button onclick="toggleDishAvailability(${item.id}, ${!item.is_available})">${item.is_available ? '‚úì –î–æ—Å—Ç—É–ø–Ω–æ' : '‚úó –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}</button>
                                <button onclick="deleteDish(${item.id})">üóëÔ∏è</button>
                            </div>
                        `;
                        grid.appendChild(dish);
                    });
                }
            });
        }

        function updateCategorySelect() {
            const select = document.getElementById('dishCategorySelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
            menuData.categories.forEach(cat => {
                select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
            });
        }

        async function deleteDish(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ?')) return;
            
            try {
                const response = await fetch('/api/menu/delete-item.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadMenu();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        }

        async function toggleDishAvailability(id, isAvailable) {
            try {
                const response = await fetch('/api/menu/update-item.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, is_available: isAvailable })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadMenu();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        }

        async function deleteCategory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? (–°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ –±–ª—é–¥–∞ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)')) return;
            
            try {
                const response = await fetch('/api/menu/delete-category.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadMenu();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        }

        document.getElementById('addCategoryBtn').addEventListener('click', () => openModal('categoryModal'));
        document.getElementById('addDishBtn').addEventListener('click', () => openModal('dishModal'));

        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/api/menu/create-category.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: formData.get('name') })
                });
                
                const data = await response.json();
                if (data.success) {
                    closeModal('categoryModal');
                    e.target.reset();
                    loadMenu();
                } else if (data.message === 'limit_reached') {
                    showPremiumModal(data.limit_type, data.current_count, data.limit, data.plan);
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        });

        document.getElementById('dishForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            let imageUrl = null;
            const imageFile = formData.get('image');
            if (imageFile && imageFile.size > 0) {
                const imageFormData = new FormData();
                imageFormData.append('image', imageFile);
                
                try {
                    const uploadResponse = await fetch('/api/upload/image.php', {
                        method: 'POST',
                        body: imageFormData
                    });
                    const uploadData = await uploadResponse.json();
                    if (uploadData.success) {
                        imageUrl = uploadData.url;
                    }
                } catch (error) {
                    console.error('Image upload error:', error);
                }
            }
            
            try {
                const response = await fetch('/api/menu/create-item.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        description: formData.get('description'),
                        category_id: formData.get('category_id'),
                        price: formData.get('price'),
                        image_url: imageUrl
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    closeModal('dishModal');
                    e.target.reset();
                    loadMenu();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        });

        // === –°–¢–û–õ–ò–ö–ò ===
        async function loadTables() {
            try {
                const response = await fetch('/api/tables/list.php');
                const data = await response.json();
                
                if (data.success) {
                    const grid = document.getElementById('tablesGrid');
                    const limitInfo = document.getElementById('tablesLimitInfo');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–∞—Ö
                    if (data.limits) {
                        const { current_tables, max_tables, plan } = data.limits;
                        if (plan === 'FREE') {
                            limitInfo.innerHTML = `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${current_tables}/${max_tables} —Å—Ç–æ–ª–∏–∫–æ–≤ (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ)`;
                        } else {
                            limitInfo.innerHTML = `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${current_tables}/${max_tables} —Å—Ç–æ–ª–∏–∫–æ–≤ (–ø—Ä–µ–º–∏—É–º —Ç–∞—Ä–∏—Ñ)`;
                        }
                    }
                    
                    grid.innerHTML = '';
                    
                    if (data.tables.length === 0) {
                        grid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary);">–ù–µ—Ç —Å—Ç–æ–ª–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–∏–∫.</p>';
                        return;
                    }
                    
                    data.tables.forEach(table => {
                        const card = document.createElement('div');
                        card.className = 'table-card';
                        card.innerHTML = `
                            <div class="table-number">‚Ññ${table.table_number}</div>
                            <div class="qr-placeholder" id="qr-${table.id}">
                                <span style="font-size: 14px; color: var(--text-secondary);">–ó–∞–≥—Ä—É–∑–∫–∞ QR...</span>
                            </div>
                            <button onclick="downloadQR(${table.id}, '${table.table_number}')" class="btn-primary" style="width: 100%; margin-bottom: 10px;">üì• –°–∫–∞—á–∞—Ç—å QR</button>
                            <button onclick="viewMenu(${table.id})" style="width: 100%; padding: 10px; background: white; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; margin-bottom: 10px;">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–Ω—é</button>
                            <button onclick="deleteTable(${table.id})" style="width: 100%; padding: 10px; background: #E53935; color: white; border: none; border-radius: 8px; cursor: pointer;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        `;
                        grid.appendChild(card);
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–≤—å—é QR-–∫–æ–¥–∞
                        loadQRPreview(table.id);
                    });
                }
            } catch (error) {
                console.error('Error loading tables:', error);
            }
        }

        async function deleteTable(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª–∏–∫?')) return;
            
            try {
                const response = await fetch('/api/tables/delete.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadTables();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        }

        function downloadQR(tableId, tableNumber) {
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º endpoint –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞
            const downloadUrl = `/api/qr/generate.php?table_id=${tableId}`;
            
            // –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = `qr-table-${tableNumber}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function viewMenu(tableId) {
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
            const menuUrl = `${window.location.origin}/menu/client.html?restaurant_id=1&table_id=${tableId}`;
            window.open(menuUrl, '_blank');
        }

        async function loadQRPreview(tableId) {
            try {
                const response = await fetch(`/api/qr/preview.php?table_id=${tableId}`);
                const data = await response.json();
                
                if (data.success && data.qr_code) {
                    const container = document.getElementById(`qr-${tableId}`);
                    if (container) {
                        container.innerHTML = `<img src="${data.qr_code}" alt="QR Code" style="width: 100%; height: 100%; object-fit: contain;">`;
                    }
                } else {
                    const container = document.getElementById(`qr-${tableId}`);
                    if (container) {
                        container.innerHTML = '<span style="font-size: 48px;">üì±</span>';
                    }
                }
            } catch (error) {
                console.error('Error loading QR preview:', error);
                const container = document.getElementById(`qr-${tableId}`);
                if (container) {
                    container.innerHTML = '<span style="font-size: 48px;">üì±</span>';
                }
            }
        }

        document.getElementById('addTableBtn').addEventListener('click', () => openModal('tableModal'));

        document.getElementById('tableForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/api/tables/create.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ table_number: formData.get('table_number') })
                });
                
                const data = await response.json();
                if (data.success) {
                    closeModal('tableModal');
                    e.target.reset();
                    loadTables();
                } else if (data.message === 'limit_reached') {
                    showPremiumModal(data.limit_type, data.current_count, data.limit, data.plan);
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        });

        // === –°–û–¢–†–£–î–ù–ò–ö–ò ===
        async function loadStaff() {
            try {
                const response = await fetch('/api/staff/list.php');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('staffList');
                    container.innerHTML = '';
                    
                    if (data.staff.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.</p>';
                        return;
                    }
                    
                    data.staff.forEach(staff => {
                        const item = document.createElement('div');
                        item.className = 'staff-item';
                        item.innerHTML = `
                            <div class="staff-info">
                                <div class="name">${staff.first_name} ${staff.last_name}</div>
                                <div class="email">${staff.email}</div>
                            </div>
                            <button onclick="deleteStaff(${staff.id})" style="padding: 8px 16px; background: #E53935; color: white; border: none; border-radius: 4px; cursor: pointer;">–£–¥–∞–ª–∏—Ç—å</button>
                        `;
                        container.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('Error loading staff:', error);
            }
        }

        async function deleteStaff(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) return;
            
            try {
                const response = await fetch('/api/staff/delete.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadStaff();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        }

        document.getElementById('addStaffBtn').addEventListener('click', () => openModal('staffModal'));

        document.getElementById('staffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/api/staff/create.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        first_name: formData.get('first_name'),
                        last_name: formData.get('last_name'),
                        email: formData.get('email'),
                        password: formData.get('password')
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    closeModal('staffModal');
                    e.target.reset();
                    loadStaff();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        });

        // === –ù–ê–°–¢–†–û–ô–ö–ò ===
        async function loadSettings() {
            try {
                const response = await fetch('/api/restaurants/get-my.php');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('restaurantName').textContent = data.restaurant.name;
                    document.getElementById('settingsName').value = data.restaurant.name;
                    document.getElementById('settingsAddress').value = data.restaurant.address || '';
                    document.getElementById('settingsPhone').value = data.restaurant.phone || '';
                    document.getElementById('settingsPlan').value = data.restaurant.plan === 'PREMIUM' ? 'Premium' : '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/api/restaurants/update-my.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        address: formData.get('address'),
                        phone: formData.get('phone')
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                    loadSettings();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        });

        async function loadStats(period = 'today') {
            try {
                const response = await fetch(`/api/orders/stats.php?period=${period}`);
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('statsContent');
                    container.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                            <div style="padding: 20px; background: var(--bg-page); border-radius: 8px;">
                                <div style="color: var(--text-secondary); margin-bottom: 10px;">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                                <div style="font-size: 32px; font-weight: 700;">${data.stats.total_orders}</div>
                            </div>
                            <div style="padding: 20px; background: var(--bg-page); border-radius: 8px;">
                                <div style="color: var(--text-secondary); margin-bottom: 10px;">–í—ã—Ä—É—á–∫–∞</div>
                                <div style="font-size: 32px; font-weight: 700; color: var(--text-accent);">${parseFloat(data.stats.total_revenue || 0).toLocaleString('ru-RU')} ‚Ç∏</div>
                            </div>
                            <div style="padding: 20px; background: var(--bg-page); border-radius: 8px;">
                                <div style="color: var(--text-secondary); margin-bottom: 10px;">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                                <div style="font-size: 32px; font-weight: 700;">${parseFloat(data.stats.avg_check || 0).toLocaleString('ru-RU')} ‚Ç∏</div>
                            </div>
                        </div>
                        <h3 style="margin-bottom: 15px;">–¢–æ–ø –±–ª—é–¥</h3>
                        <div style="border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden;">
                            ${data.top_dishes.map((dish, i) => `
                                <div style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="color: var(--text-secondary); margin-right: 10px;">#${i + 1}</span>
                                        <span style="font-weight: 600;">${dish.name}</span>
                                    </div>
                                    <div>
                                        <span style="margin-right: 20px;">${dish.total_quantity} —à—Ç</span>
                                        <span style="color: var(--text-accent); font-weight: 600;">${parseFloat(dish.total_revenue).toLocaleString('ru-RU')} ‚Ç∏</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const pageId = item.dataset.page;
                
                if (pageId === 'menu') {
                    loadMenu();
                } else if (pageId === 'tables') {
                    loadTables();
                } else if (pageId === 'staff') {
                    loadStaff();
                } else if (pageId === 'settings') {
                    loadSettings();
                    loadStats('today');
                }
            });
        });

        checkAuth();
        setInterval(loadDashboardStats, 30000);
    </script>

</body>
</html>

